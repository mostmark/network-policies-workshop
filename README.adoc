= Network Policies Introduction Workshop

A hands-on workshop that teaches Kubernetes network policies on Red Hat OpenShift. Participants learn to control pod-to-pod communication using ingress and egress policies, implement cross-namespace isolation, and troubleshoot connectivity issues.

The workshop uses a scenario-based approach where participants evaluate network security for a shared OpenShift platform, progressing from default networking behavior through deny-all baselines to selective allow policies.

The content is built with Antora and published as a static site using the Red Hat Demo Platform (Showroom) UI theme.

Preview the lab guide https://mostmark.github.io/network-policies-workshop/[here] 

== Local development

=== Preview with Antora viewer (recommended)

To preview the workshop content locally, run the Antora viewer container:

[source,sh]
----
podman run --rm --name antora -v $PWD:/antora -p 8080:8080 -i -t ghcr.io/juliaaano/antora-viewer
----

For SELinux environments, append `:z` to the volume mount:

[source,sh]
----
podman run --rm --name antora -v $PWD:/antora:z -p 8080:8080 -i -t ghcr.io/juliaaano/antora-viewer
----

Then open http://localhost:8080 in your browser. When you make changes to the content, stop the container and run it again to see updates. Live-reload is not supported.

== Cluster preparation

When running this workshop on a shared OpenShift cluster, use the provided scripts to set up and tear down per-user resources.

=== Prepare the cluster

The `prepare-cluster.sh` script automates the following:

* Installs the OpenShift Web Terminal operator
* Creates 4 projects per user: `network-policy-test-userN`, `backend-team-userN`, `frontend-team-userN`, and `terminal-userN`
* Labels `frontend-team-userN` with `team=frontend` (required for cross-namespace policies in Module 3)
* Grants each user `admin` access to their projects
* Pre-starts a Web Terminal DevWorkspace in each user's terminal project

[source,sh]
----
./prepare-cluster.sh
----

You will be prompted for the number of users to prepare.

=== Clean up the cluster

The `cleanup-cluster.sh` script removes all resources created by the prepare script:

* Deletes all per-user projects
* Uninstalls the Web Terminal operator

[source,sh]
----
./cleanup-cluster.sh
----

=== Build and push a container image

The `Containerfile` builds a UBI9-based container with Apache httpd that serves the pre-built workshop site on port 8080. The container runs as a non-root user and is suitable for deployment on OpenShift.

To build the site content first, run the Antora viewer as described above, which generates output in the `www/` directory.

Then use the `build-push-container.sh` script to build a multi-architecture image (amd64 and arm64) and push it to Quay.io:

[source,sh]
----
export QUAY_USER=your-quay-username
./build-push-container.sh
----

The script builds the image as `quay.io/$QUAY_USER/network-policies-lab:latest` and pushes it to the registry. You can then run the container locally:

[source,sh]
----
podman run --rm -p 8080:8080 quay.io/$QUAY_USER/network-policies-lab:latest
----
